<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
	<title>the Epic Storm -- Calculator</title>
	<meta charset="utf-8">
	<script type="text/javascript" src="jsbayes/jsbayes.js"></script>
</head>
<body>

</body>
</html>
<script>
	function brainstorm(x, y)
	{
		return 1.0 - (((x - y) / x) * ((x - y - 1) / (x - 1) * ((x - y - 2) / (x - 2))));
	}
	function ponder(x,y)
	{
		return 1.0 - ((((x - y) / x) * (((x - y) / x) * ((x - y - 1) / (x - 1) * ((x - y - 2) / (x - 2))))));
	}
	function joint(cardA, cardB, totalCards)
	{
		return 6.0 * cardA / totalCards * cardB / (totalCards - 1) - 3 * cardA / totalCards * cardB / (totalCards - 1) * (cardA - 1) / (totalCards - 2) - 3 * cardA / totalCards * cardB / (totalCards - 1) * (cardB - 1) / (totalCards - 2)
	}
	function threeCards(cardA, cardB, cardC, totalCards)
	{
		return 6 * cardA * cardB * cardC / (totalCards * (totalCards - 1) * (totalCards - 2));
	}
	function twoLookPonder(x,y)
	{
		return 1.0 - ((((x - y) / x) * (((x - y) / x) * ((x - y - 1) / (x - 1)))));
	}
	function oneLookPonder(x,y)
	{
		return y/(x-2) + y/(x);
	}
	function oneLookBrainstorm(x,y)
	{
		return y/(x-2);
	}
	function makeSetPonder(cardFunction, oneLookCardFunction, cards, wins, ponders, preordains, brainstorms)
	{
		var ponderShuffle = (1 - (brainstorm(cards, (wins + ponders + preordains + brainstorms + 1))));

		var winVal = ponderShuffle * (cardFunction(cards, wins)) + (1-ponderShuffle) * oneLookCardFunction(cards, wins);

		var ponderVal = ponderShuffle * (cardFunction(cards, ponders) - joint(ponders, wins, cards)) + (1-ponderShuffle) * oneLookCardFunction(cards, ponders);

		var preordainVal = ponderShuffle * (cardFunction(cards, preordains) - joint(preordains, wins, cards) - joint(preordains, ponders, cards) + threeCards(preordains, ponders, wins, cards)) + (1-ponderShuffle) * (oneLookCardFunction(cards,preordains));

		var brainstormVal = ponderShuffle * (cardFunction(cards, brainstorms) - joint(brainstorms, wins, cards) - joint(brainstorms, ponders, cards) - joint(brainstorms, preordains, wins) + threeCards(brainstorms, ponders, wins, cards) + threeCards(brainstorms, preordains, wins, cards) + threeCards(brainstorms, ponders, preordains, cards)) +  (1-ponderShuffle) * oneLookCardFunction(cards, brainstorms);

		var missVal = 1 - winVal - preordainVal - ponderVal	- preordainVal;

		return [winVal, ponderVal, preordainVal, brainstormVal, missVal]; 
	}
	function makeSetPreordain()
	{

	}
	function makeSetBrainstorm()
	{

	}
	function calculate(cards, wins, ponders, preordains, brainstorms, blueMana)
	{
		var cantripNetwork = jsbayes.newGraph();
		var n1 = cantripNetwork.addNode('A', ['win', 'ponder', 'preordain', 'brainstorm', 'miss']);
		var n2 = cantripNetwork.addNode('B', ['win', 'ponder', 'preordain', 'brainstorm', 'miss']);
		var n3 = cantripNetwork.addNode('C', ['win', 'ponder', 'preordain', 'brainstorm', 'miss']);
		var n4 = cantripNetwork.addNode('D', ['win', 'miss']);

		n2.addParent(n1);
		n3.addParent(n2);
		n3.addParent(n1);
		n4.addParent(n3);
		n4.addParent(n2);

		n1.cpt = [
				brainstorm(cards, wins),
				brainstorm(cards, ponders) - joint(ponders,wins, cards),
				brainstorm(cards, preordains) - joint(preordains, wins, cards) - joint(preordains, ponders, cards) + threeCards(preordains, ponders, wins, cards),
				brainstorm(cards, brainstorms) - joint(brainstorms, wins, cards) - joint(brainstorms, ponders, cards) - joint(brainstorms, preordains, cards) + threeCards(brainstorms, ponders, wins) + threeCards(brainstorms, preordains, wins),

				brainstorm(cards, 53 - wins, ponders, preordains, brainstorms)
			];

		var ponderXwin = oneLookPonder(cards-1, wins);
		var ponderXponder = oneLookPonder(cards-1, ponders-1);
		var ponderXpreordain = oneLookPonder(cards-1, preordains);
		var ponderXbrainstorm = oneLookPonder(cards-1, brainstorms);
		var ponderXmiss = 1 - ponderXwin - ponderXpreordain - ponderXponder	- ponderXpreordain;

		var preordainXwin = oneLookBrainstorm(cards-1, wins);
		var preordainXponder = oneLookBrainstorm(cards -1, ponders);
		var preordainXpreordain = oneLookBrainstorm(cards-1, preordains-1);
		var preordainXbrainstorm = oneLookBrainstorm(cards-1, brainstorms);
		var preordainXmiss = 1 - preordainXwin - preordainXpreordain - preordainXponder	- preordainXpreordain;

		var brainstormXwin = oneLookBrainstorm(cards-1, wins);
		var brainstormXponder = oneLookBrainstorm(cards -1, ponders);
		var brainstormXpreordain = oneLookBrainstorm(cards-1, preordains);
		var brainstormXbrainstorm = oneLookBrainstorm(cards-1, brainstorms-1);
		var brainstormXmiss = 1 - brainstormXwin - brainstormXpreordain - brainstormXponder	- brainstormXpreordain;


		n2.cpt = [
					[1,0,0,0,0],
					[ponderXwin, ponderXponder, ponderXpreordain, ponderXbrainstorm, ponderXmiss],
					[preordainXwin, preordainXponder, preordainXpreordain, preordainXbrainstorm, preordainXmiss],
					[brainstormXwin, brainstormXponder, brainstormXpreordain, brainstormXbrainstorm, brainstormXmiss],
					[0,0,0,0,1]
				];
		var ponderShuffle = 0;
		var ponderXpreordainXwin = ponderShuffle * (brainstorm(cards-2, wins)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, wins);
		var ponderXpreordainXponder = ponderShuffle * (brainstorm(cards-2, ponders-1) - joint(ponders-1, wins, cards - 2)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, ponders-1);
		var ponderXpreordainXpreordain = ponderShuffle * (brainstorm(cards-2, preordains-1) + (1-ponderShuffle) - joint(preordains-1, wins, cards-2) - joint(preordains-1, ponders-1, cards-2) + threeCards(preordains-1, ponders-1, wins, cards-2)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, preordains-1);
		var ponderXpreordainXbrainstorm = ponderShuffle * (brainstorm(cards-2, brainstorms) - joint(brainstorms, wins, cards-2) - joint(brainstorms, ponders-1, cards-2) - joint(brainstorms, preordains-1, wins) + threeCards(brainstorms, ponders-1, wins, cards-2) + threeCards(brainstorms, preordains-1, wins, cards-2)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, brainstorms);
		var ponderXpreordainXmiss = 1 - ponderXpreordainXwin - ponderXpreordainXpreordain - ponderXpreordainXponder	- ponderXpreordainXpreordain;

		var ponderXbrainstormXwin = ponderShuffle * (brainstorm(cards-2, wins)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, wins);
		var ponderXbrainstormXponder = ponderShuffle * (brainstorm(cards-2, ponders-1) - joint(ponders-1, wins, cards - 2)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, ponders-1);
		var ponderXbrainstormXpreordain = ponderShuffle * (brainstorm(cards-2, preordains) + (1-ponderShuffle) - joint(preordains, wins, cards-2) - joint(preordains, ponders-1, cards-2) + threeCards(preordains, ponders-1, wins, cards-2)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, preordains);
		var ponderXbrainstormXbrainstorm = ponderShuffle * (brainstorm(cards-2, brainstorms-1) - joint(brainstorms-1, wins, cards-2) - joint(brainstorms-1, ponders-1, cards-2) - joint(brainstorms-1, preordains, wins) + threeCards(brainstorms-1, ponders-1, wins, cards-2) + threeCards(brainstorms-1, preordains, wins, cards-2)) + (1-ponderShuffle) * oneLookBrainstorm(cards-2, brainstorms-1);
		var ponderXbrainstormXmiss = 1 - ponderXbrainstormXwin - ponderXbrainstormXpreordain - ponderXbrainstormXponder	- ponderXbrainstormXpreordain;


		var bottomBoth;
		var bottomOne;
		var preordainXponderXwin = bottomBoth * (ponder(cards-2, wins)) + bottomOne * (twoLookPonder(cards-2, wins)) + (1-bottomBoth-bottomOne) * oneLookPonder(cards-2,wins); 
		var preordainXponderXponder = bottomBoth * (ponder(cards-2, ponders-1)) + bottomOne * (twoLookPonder(cards-2, ponders-1)) + (1-bottomBoth-bottomOne) * oneLookPonder(cards-2,ponders-1);

		console.log(makeSetPonder(ponder,oneLookPonder, cards-2, wins, ponders-2, preordains, brainstorms));

		n3.cpt = [
				[1.0,0.0,0.0,0.0,0.0], //win, win
				[0.0,0.0,0.0,0.0,0.0], //win, ponder
				[0.0,0.0,0.0,0.0,0.0], //win, preordain
				[0.0,0.0,0.0,0.0,0.0], //win, brainstorm
				[0.0,0.0,0.0,0.0,0.0], //win, miss
				[1.0,0.0,0.0,0.0,0.0], //ponder, win
				makeSetPonder(ponder, oneLookPonder, cards-2, wins, ponders-2, preordains, brainstorms), //ponder, ponder
				makeSetPonder(ponder, oneLookPonder, cards-2, wins, ponders-1, preordains-1, brainstorms), //ponder, preordain
				makeSetPonder(ponder, oneLookPonder, cards-2, wins, ponders-1, preordains, brainstorms-1), //ponder, brainstorm
				[0.0,0.0,0.0,0.0,1.0], //ponder, miss
				[1.0,0.0,0.0,0.0,0.0], //preordain, win
				[], //preordain, ponder
				[], //preordain, preordain
				[], //preordain, brainstorm
				[0.0,0.0,0.0,0.0,1.0], //preordain, miss
				[1.0,0.0,0.0,0.0,0.0], //brainstorm, win
				[], //brainstorm, ponder
				[], //brainstorm, preordain
				[], //brainstorm, brainstorm
				[0.0,0.0,0.0,0.0,1.0], //brainstorm, miss
				[0.0,0.0,0.0,0.0,0.0], //miss, win
				[0.0,0.0,0.0,0.0,0.0], //miss, ponder
				[0.0,0.0,0.0,0.0,0.0], //miss, preordain
				[0.0,0.0,0.0,0.0,0.0], //miss, brainstorm
				[0.0,0.0,0.0,0.0,1.0]  //miss, miss
			];

	}
</script>